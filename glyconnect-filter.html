<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../paper-header-panel/paper-header-panel.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">


<!--
`glyconnect-filter`
This element provides filter box in glyconnect

@demo demo/index.html
-->

<dom-module id="glyconnect-filter">
  <template>
    <style is="custom-style" include="iron-flex"></style>
    <style>
      :host {
        display: block;
      }
      iron-icon[disabled]{
        display: none;
      }
      paper-button.indigo {
        background-color: var(--paper-indigo-500);
        color: white;
        --paper-button-raised-keyboard-focus: {
            color: white !important;
        };
      }
      paper-button#filterToggleButton {
        width: 100%;
      }
      .paper-header {
        font-family: "Roboto";
        height: 45px;
        font-size: 20px;
        padding: 0 10px;
        color: red;
        transition: height 0.2s;
      }
      paper-button#generateButton {
            height: 50%;
            margin: 15px 30px;
        }
      #filterToggleButton {
        min-width: 760px;
      }

      #glycanFilterHeader {
        font-size: 16px;
        font-weight: 500;
        line-height: 25px;
      }
      #glycanFilterBox{
        border: 1px solid black;
        margin-left: 16px;
        margin-right: 36px;
        min-width: 758px;
        border-radius: 0 0 5px 5px;
        border: 1px solid rgba(0, 0, 0, 0.2);
      }
      #rangeBox {
        padding: 30px 20px 20px 20px;
      }
      #clearIcon {
        margin: 10px 10px 0 0;
        float: right;
      }
    </style>
    <iron-ajax
            id="ajaxDictionary"
            handle-as="json"
            method="GET"
            last-response="{{globalDictionary}}"
            on-response="handleResponse"
    ></iron-ajax>

        <paper-header-panel id="glycanFilterPanel" class="blue" mode="seamed">
                <div id="glycanFilterHeader" class="paper-header">
                    <paper-button id="filterToggleButton" class="indigo" on-click="_toggleGlycanFilter" toggles raised>
                        <iron-icon id="expandIcon" icon="icons:chevron-right" alt="unfold" ></iron-icon>
                        <iron-icon id="foldIcon" icon="icons:expand-more" alt="fold" disabled></iron-icon>
                        Glycan property filters
                    </paper-button>
                </div>
            </paper-header-panel>
            <iron-collapse id="glycanFilterBox" class="horizontal center-justified">
                <iron-icon id="clearIcon" icon="icons:autorenew" alt="reset" on-click="_reset"></iron-icon>
                <div id="rangeBox" class="layout horizontal">
                        <paper-dropdown-menu label="Type" style="padding-right: 20px;">
                          <paper-listbox class="dropdown-content" selected="{{typeSelected}}" attr-for-selected="glycantype">
                            <template is="dom-repeat" items="{{glycanType}}">
                              <paper-item glycantype="{{item}}">{{item}}</paper-item>
                            </template>
                          </paper-listbox>
                        </paper-dropdown-menu>

                        <paper-dropdown-menu label="Core" style="padding-right: 20px;">
                          <paper-listbox class="dropdown-content" selected="{{coreSelected}}" attr-for-selected="core">
                            <template is="dom-repeat" items="{{coreType}}">
                              <paper-item core="{{item}}">{{item}}</paper-item>
                            </template>
                          </paper-listbox>
                        </paper-dropdown-menu>

                        <paper-dropdown-menu label="Properties" style="padding-right: 20px;">
                          <paper-listbox class="dropdown-content" selected="{{propertySelected}}" attr-for-selected="property">
                            <template is="dom-repeat" items="{{prop}}">
                              <paper-item property="{{item}}">{{item}}</paper-item>
                            </template>
                          </paper-listbox>
                        </paper-dropdown-menu>

                        <paper-dropdown-menu label="Determinants">
                          <paper-listbox class="dropdown-content" selected="{{deterSelected}}" attr-for-selected="determinants">
                            <template is="dom-repeat" items="{{deter}}">
                              <paper-item determinants="{{item}}">{{item}}</paper-item>
                            </template>
                          </paper-listbox>
                        </paper-dropdown-menu>
                        <template id="t" is="dom-bind">
                          <textarea value="{{dataToPost::input}}"></textarea>
                          <paper-button id="generateButton" class="indigo" on-tap="generate">Generate</paper-button>
                          <iron-ajax
                                  id="ajaxKey"
                                  method="POST"
                                  url=''
                                  on-response="handleComposition"
                          ></iron-ajax>
                        </template>
                    </div>
       </iron-collapse>
  </template>

  <script>
    Polymer({

      is: 'glyconnect-filter',

      properties: {
        typeSelected: {
          type: String,
          observer: "_typeChange"
        },
        coreSelected: {
          type: String,
          observer: "_coreSelectedChange"
        },
        propertySelected: {
          type: String,
          observer: "_propertySelectedChange"
        },
        deterSelected: {
          type: String,
          observer: "_propertySelectedChange"
        },
        prop: {
          type: String
        }
      },

      attached: function(){
        this.$.ajaxDictionary.url = this.resolveUrl('dictionary/globalDictionary.json');
        this.$.ajaxDictionary.generateRequest();
      },

      handleResponse: function(){
        this.glycanType = this.globalDictionary.type;
      },

      _toggleGlycanFilter: function () {
        this.$.glycanFilterBox.toggle();
        if(this.$.foldIcon.hasAttribute('disabled')){
            this.$.expandIcon.setAttribute('disabled', 'true');
            this.$.foldIcon.removeAttribute('disabled');
        }else{
            this.$.foldIcon.setAttribute('disabled', 'true');
            this.$.expandIcon.removeAttribute('disabled');
        }
      },
      _reset: function () {
        this.typeSelected = null;
        this.coreSelected = null;
        this.propertySelected = null;
        this.deterSelected = null;
      },
      _typeChange: function(){
        this.coreType = this.globalDictionary[this.typeSelected];
      },

      _coreSelectedChange: function(){
        this.prop = this.globalDictionary[this.typeSelected+'_'+this.coreSelected];
      },
      _propertySelectedChange: function(){
        this.deter = this.globalDictionary[this.typeSelected+'_'+this.coreSelected+'_'+this.propertySelected];
      },
      _generate: function(){
          console.loge(deter)

      }
      (function (document) {
      'use strict';
      document.addEventListener('WebComponentsReady', function() {

          // We have to bind the template with the model
          var t = document.querySelector('#t');
          var ajaxRequest = t.$.dataAjax;

          // make the iron-ajax call
          t.postData = function() {
            ajaxRequest.body = {
              'text': t.dataToPost;
            }
            ajaxRequest.generateRequest();
          }

          //callback on request complete
          t.postComplete = function(){
            alert('whoa! request complete');
          }
      });
      })(document);

      /* Possible Advanced Feature
          - server call for populate drop-down multi selections
       */

    });
  </script>
</dom-module>
