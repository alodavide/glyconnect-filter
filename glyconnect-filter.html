<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../sortable-list/sortable-list.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-styles/element-styles/paper-material-styles.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../vaadin-upload/vaadin-upload.html">
<link rel="import" href="../iron-list/iron-list.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../iron-localstorage/iron-localstorage.html">
<link rel="import" href="../paper-slider/paper-slider.html">
<!--
`glyconnect-filter`
This element provides filter box in glyconnect
@demo demo/index.html
-->

<dom-module id="glyconnect-filter">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment paper-material-styles"></style>
        <style>
            :host {
                display: block;
            }
            iron-icon[disabled]{
                display: none;
            }
            .enzymeList{
                padding: 5px;
                @apply(--layout-horizontal);
                @apply(--layout-wrap);
                min-width: 200px;
                align-content: center;
            }
            .enzymeSelected{
                padding: 5px;
                @apply(--layout-horizontal);
                @apply(--layout-wrap);
                min-height: 100px;
                align-items: right;
            }
            paper-button.indigo {
                background-color: var(--paper-indigo-500);
                color: white;
                --paper-button-raised-keyboard-focus: {
                    color: white !important;
                };
            }
            paper-button.filterToggleButton {
                width: 100%;
            }
            paper-button.updateButton {
                margin: 13px;
                font-size: 16px;
            }
            .glycanFilterHeader {
                font-size: 16px;
                font-weight: 500;
                line-height: 25px;
            }
            .card {
                /*background-color: #cc3300;*/
                font-size: 16px;
                padding: 15px 15px 15px 15px;
                /*box-sizing: border-box;*/
                margin: 10px;
                flex: 0 0 auto;
                color: white;
            }
            paper-tab:not(:last-child) {
                border-right: solid;
                border-color: #757575 ;
                border-width: 1px;
            }
            paper-tab.iron-selected {
                background-color: var(--paper-indigo-500);
                color: white;
            }
            paper-tabs{
              --paper-tabs-selection-bar-color: #eee;
              background-color: #eeeeee;
              color: black;
              font-size: 20px;
              font-weight: 600;
              border-radius: 5px;
              margin: 20px;
              box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }
            .materialCard {
                margin: 20px;
                background: #eeeeee;
                @apply --paper-material-elevation-2;
            }
            paper-item.fancy {
              --paper-item-focused: {
                background: var(--paper-amber-500);
              };
              --paper-item-focused-before: {
                opacity: 0;
              };
            }
            /*.toggle-span-label {
                position: relative;
                display: inline-block;
                vertical-align: middle;
                padding-left:  8px;
                padding-top: 2px;
                pointer-events: none;
                font-family: 'Roboto', 'Noto', sans-serif;
                min-width: 140px;
            }*/
            .doubleRangeBox{
                width: 300px;
                margin: 10px 20px 10px 20px;
            }
            #rangeBox {
                padding: 30px 20px 20px 20px;
            }
            #clearIcon {
              margin: 40px 20px 20px 20px;
              float: right;
            }
        </style>
        <iron-ajax
                id="ajaxDictionary"
                handle-as="json"
                method="GET"
                on-response="handleResponse"
        ></iron-ajax>
        <iron-ajax
                id="proteinDictionary"
                handle-as="json"
                method="GET"
                on-response="handleProtein"
        ></iron-ajax>
        <!-- <iron-ajax
                id="compoDictionary"
                handle-as="json"
                method="GET"
                on-response="handleCompo"
        ></iron-ajax> -->
        <app-header-layout mode="seamed">
            <div class ="glycanFilterHeader">
                <paper-button class="indigo filterToggleButton" on-click="_toggleProtein" toggles raised>
                    <iron-icon id="expandIcon" icon="icons:chevron-right" alt="unfold" ></iron-icon>
                    <iron-icon id="foldIcon" icon="icons:expand-more" alt="fold" disabled></iron-icon>
                    Protein
                </paper-button>
            </div>
        </app-header-layout>
        <iron-collapse id="glycanFilterProt" class="horizontal center-justified">
              <vaadin-combo-box id="protDropDown" required label="Protein"></vaadin-combo-box>
              <paper-button class="indigo updateButton" id="sendDataProt" raised>Search</paper-button>
        </iron-collapse>
        <br><br>
        <!-- <app-header-layout mode="seamed">
            <div class="glycanFilterHeader">
                <paper-button class="filterToggleButton indigo" on-click="_toggleCompo" toggles raised>
                    <iron-icon id="expandIcon" icon="icons:chevron-right" alt="unfold" ></iron-icon>
                    <iron-icon id="foldIcon" icon="icons:expand-more" alt="fold" disabled></iron-icon>
                    Composition
                </paper-button>
            </div>
        </app-header-layout>
        <iron-collapse id="glycanFilterCompo" class="horizontal center-justified">
          <br>
          <div>
            <paper-item class='fancy'>Number of monosaccharides as follow: Hex, HexNAc, DeoxyHex (e.g. fucose), NeuAc, NeuAg, Pentose (e.g. xylose), Sulfate, Phosphate, KDN, KDO, HexA, Methyl, Acetyl, Other</paper-item>
          </div>
          <vaadin-combo-box id="compoDropDown" required label="Composition"></vaadin-combo-box>
          <paper-button class="indigo updateButton" id="sendDataComp" raised>Search</paper-button>
        </iron-collapse>
        <br><br> -->
        <app-header-layout mode="seamed">
            <div class="glycanFilterHeader">
                <paper-button class="filterToggleButton indigo" on-click="_toggleGlycanFilter" toggles raised>
                    <iron-icon id="expandIcon" icon="icons:chevron-right" alt="unfold" ></iron-icon>
                    <iron-icon id="foldIcon" icon="icons:expand-more" alt="fold" disabled></iron-icon>
                    Composition
                </paper-button>
            </div>
        </app-header-layout>
        <iron-collapse id="glycanFilterBox" class="horizontal center-justified">
          <div class="layout vertical flex">
           <paper-tabs selected="{{selected}}"  no-bar>
               <paper-tab>File upload</paper-tab>
               <paper-tab>List of composition</paper-tab>
               <paper-tab>Monosaccharide selectors</paper-tab>
           </paper-tabs>
           <iron-pages selected="{{selected}}">
              <div class="layout materialCard flex">
                   <vaadin-upload accept="application/pdf"></vaadin-upload>
               </div>
               <div class="layout materialCard flex">
                   <paper-input style ="padding: 10px" label="composition input"></paper-input>
               </div>
               <div class="layout materialCard flex"><link rel="import" href="../iron-list/iron-list.html">
                 <iron-icon id="clearIcon" icon="icons:autorenew" alt="reset" on-click="_reset"></iron-icon>
                   <div id="rangeBox" class="layout horizontal wrap">
                       <template id="rangeBoxTemplate" is="dom-repeat" items="{{monosaccharides}}">
                           <div class="doubleRangeBox">
                               <!-- <div class="layout horizontal">
                                   <paper-toggle-button id="{{item}}Toggle" checked on-change="_changeOfSlider">{{_getLabel(item)}} : </paper-toggle-button>
                                   <span id="{{item}}Label" class="toggle-span-label"> {{_getLabel(item)}}: min value</span>
                                   <iron-localstorage id="{{item}}ToggleCache" name="{{item}}ToggleCache"></iron-localstorage>
                               </div><br> -->
                               <span id="{{item}}Label">{{_getLabel(item)}}</span>
                               <div class="layout horizontal">

                                 <paper-slider id="{{item}}RangeMin" edge = 'Min' snaps max="12" max-markers="12" step="1" value = '0' on-change="_changeOfRange" editable></paper-slider>
                                 <span>Min</span>
                                 <iron-localstorage id="{{item}}RangeCacheMin" name="{{item}}RangeCacheMin"></iron-localstorage>
                               </div>
                               <div class="layout horizontal">

                                 <paper-slider id="{{item}}RangeMax" edge = 'Max' snaps max="12" max-markers="12" step="1" value = '0' on-change="_changeOfRange" editable></paper-slider>
                                 <span>Max</span>
                                 <iron-localstorage id="{{item}}RangeCacheMax" name="{{item}}RangeCacheMax"></iron-localstorage>
                               </div>
                           </div>
                       </template>
                       <paper-button id="updateButton" class="indigo" on-tap='_getCompo'>Search</paper-button>
                   </div>
               </div>
             </iron-pages>
           </div>
        </iron-collapse>
        <br><br>
        <app-header-layout mode="seamed">
            <div class="glycanFilterHeader">
                <paper-button class="indigo filterToggleButton" on-click="_toggleNGlycan" toggles raised>
                    <iron-icon id="expandIcon" icon="icons:chevron-right" alt="unfold" ></iron-icon>
                    <iron-icon id="foldIcon" icon="icons:expand-more" alt="fold" disabled></iron-icon>
                    N-linked glycans
                </paper-button>
            </div>
        </app-header-layout>
        <iron-collapse id="glycanFilterN" class="horizontal center-justified">
            <div class="layout horizontal flex" >
              <div class="layout materialCard flex">
                    <app-toolbar>
                        <paper-icon-button disabled style="color: white" icon="icons:view-list"></paper-icon-button>
                        <span class="title">N-Glycan</span>
                    </app-toolbar>
                    <div id="selectedN" class="enzymeSelected">
                     </div>
                    <div class="horizontal end-justified layout">
                        <paper-button class="indigo updateButton" on-tap="selectedPropN">Search</paper-button>
                        <paper-button typeLink="N" class="indigo updateButton" on-tap="clearFilter">Clear</paper-button>
                    </div>
              </div>
            </div>
              <div class="layout vertical flex">
               <paper-tabs selected="{{selected}}"  no-bar>
                   <paper-tab>Cores</paper-tab>
                   <paper-tab>Structural properties</paper-tab>
                   <paper-tab>Determinants</paper-tab>
               </paper-tabs>
               <iron-pages selected="{{selected}}">
                  <div class="layout materialCard flex">
                       <template is="dom-repeat" items="{{coreTypeN}}">
                            <paper-button typeLink="N" id={{item.name}}N raised data-id$="{{item.class}}={{item.name}}" coreTypeN="{{item}}" class="card" style$="background-color:{{item.color}}" on-tap="createTag">{{item.name}}</paper-button>
                       </template>
                   </div>
                   <div class="layout materialCard flex">
                       <template is="dom-repeat" items="{{propN}}">
                           <paper-button typeLink="N" id="{{item.name}}N" raised data-id$="{{item.class}}={{item.name}}" propN="{{item}}" class="card" style$="background-color:{{item.color}}" on-tap="createTag">{{item.name}}</paper-button>
                       </template>
                   </div>
                   <div class="layout materialCard flex"><link rel="import" href="../iron-list/iron-list.html">
                       <template is="dom-repeat" items="{{detN}}">
                           <paper-button typeLink="N" id="{{idCreator(item.name)}}N" raised data-id$="{{item.class}}={{item.name}}" detN="{{item}}" class="card" style$="background-color:{{item.color}}" on-tap="createTag">{{item.name}}</paper-button>
                       </template>
                   </div>
               </iron-pages>
             </div>
        </iron-collapse>
        <br><br>
        <app-header-layout mode="seamed">
            <div class="glycanFilterHeader">
                <paper-button class="indigo filterToggleButton" on-click="_toggleOGlycan" toggles raised>
                    <iron-icon id="expandIcon" icon="icons:chevron-right" alt="unfold" ></iron-icon>
                    <iron-icon id="foldIcon" icon="icons:expand-more" alt="fold" disabled></iron-icon>
                    O-linked glycans
                </paper-button>
            </div>
        </app-header-layout>
        <iron-collapse id="glycanFilterO" class="horizontal center-justified">
            <div class="layout horizontal flex" >
                <div class="layout materialCard flex">
                    <app-toolbar>
                        <paper-icon-button disabled style="color: white" icon="icons:view-list"></paper-icon-button>
                        <span class="title">O-Glycan</span>
                    </app-toolbar>
                    <div id="selectedO" class="enzymeSelected">
                     </div>
                    <div class="horizontal end-justified layout">
                      <paper-button class="indigo updateButton" on-tap="selectedPropO">Search</paper-button>
                      <paper-button typeLink="O" class="indigo updateButton" on-tap="clearFilter">Clear</paper-button>
                    </div>
                </div>
            </div>
            <div class="layout vertical flex">
             <paper-tabs selected="{{selected}}"  no-bar>
                 <paper-tab>Cores</paper-tab>
                 <paper-tab>Structural properties</paper-tab>
                 <paper-tab>Determinants</paper-tab>
             </paper-tabs>
             <iron-pages selected="{{selected}}">
                <div class="layout materialCard flex">
                    <template is="dom-repeat" items="{{coreTypeO}}">
                        <paper-button typeLink="O" raised id={{idCreator(item.name)}}O data-id$="{{item.class}}={{item.name}}" coreTypeO="{{item}}" class="card" style$="background-color:{{item.color}}" on-tap="createTag">{{item.name}} </paper-button>
                    </template>
                </div>
                <div class="layout materialCard flex">
                    <template is="dom-repeat" items="{{propO}}">
                        <paper-button typeLink="O" raised id={{item.name}}O data-id$="{{item.class}}={{item.name}}" propO="{{item}}" class="card" style$="background-color:{{item.color}}" on-tap="createTag">{{item.name}}</paper-button>
                    </template>
                </div>
                <div class="layout materialCard flex">
                    <template is="dom-repeat" items="{{detO}}">
                        <paper-button typeLink="O" raised id={{idCreator(item.name)}}O data-id$="{{item.class}}={{item.name}}" detO="{{item}}" class="card" style$="background-color:{{item.color}}" on-tap="createTag">{{item.name}}</paper-button>
                    </template>
                </div>
              </iron-pages>
            </div>
        </iron-collapse>
        <br><br>
        <app-header-layout mode="seamed">
            <div class="glycanFilterHeader">
                <paper-button class="indigo filterToggleButton" on-click="_toggleNOGlycan" toggles raised>
                    <iron-icon id="expandIcon" icon="icons:chevron-right" alt="unfold" ></iron-icon>
                    <iron-icon id="foldIcon" icon="icons:expand-more" alt="fold" disabled></iron-icon>
                    Non-attached to proteins
                </paper-button>
            </div>
        </app-header-layout>
        <iron-collapse id="glycanFilterNO" class="horizontal center-justified">
            <div class="layout horizontal flex" >
                <div class="layout materialCard flex">
                    <app-toolbar>
                        <paper-icon-button disabled style="color: white" icon="icons:view-list"></paper-icon-button>
                        <span class="title"> Non-attached to proteins</span>
                    </app-toolbar>
                    <div id="selectedNP" class="enzymeSelected">
                     </div>
                    <div class="horizontal end-justified layout">
                      <paper-button class="indigo updateButton" on-tap="selectedPropNP">Search</paper-button>
                      <paper-button typeLink="NP" class="indigo updateButton" on-tap="clearFilter">Clear</paper-button>
                    </div>
                </div>
            </div>
            <div class="layout vertical flex">
             <paper-tabs selected="{{selected}}"  no-bar>
                 <paper-tab>Cores</paper-tab>
                 <paper-tab>Structural properties</paper-tab>
                 <paper-tab>Determinants</paper-tab>
             </paper-tabs>
             <iron-pages selected="{{selected}}">
                <div class="layout materialCard flex">
                    <template is="dom-repeat" items="{{coreTypeNP}}">
                        <paper-button typeLink="NP" raised id={{item.name}}NP data-id$="{{item.class}}={{item.name}}" coreTypeNP="{{item}}" class="card" style$="background-color:{{item.color}}" on-tap="createTag">{{item.name}} </paper-button>
                    </template>
                </div>
                <div class="layout materialCard flex">
                    <template is="dom-repeat" items="{{propNP}}">
                        <paper-button typeLink="NP" raised id={{item.name}}NP data-id$="{{item.class}}={{item.name}}" propNP="{{item}}" class="card" style$="background-color:{{item.color}}" on-tap="createTag">{{item.name}}</paper-button>
                    </template>
                </div>
                <div class="layout materialCard flex">
                    <template is="dom-repeat" items="{{detNP}}">
                        <paper-button typeLink="NP" raised id={{idCreator(item.name)}}NP data-id$="{{item.class}}={{item.name}}" detO="{{item}}" class="card" style$="background-color:{{item.color}}" on-tap="createTag">{{item.name}}</paper-button>
                    </template>
                </div>
              </iron-pages>
            </div>
        </iron-collapse>
    </template>

    <script>
    /** @polymerElement */
    class GlyconnectFilter extends Polymer.Element {
      static get is() { return 'glyconnect-filter'; }
      static get properties() {
        return {
          repos: {
            type: Array
          },
          selected: {
            type: String,
            value: 0
          },
          filterOutput: {
            type: Array,
            reflectToAttribute: true,
            notify: true
          },
          monosaccharides: {
            type: Array,
            value: ['Hex', 'HexNAc', 'dHex', 'NeuAc', 'NeuGc', 'Pen', 'S', 'P', 'Kdn', 'Kdo', 'HexA',  'Methyl', 'Acetyl', 'Other']
          },
          labels: {
              type: Object,
              value: {
                  'Hex': 'Hex',
                  'HexNAc': 'HexNAc',
                  'dHex': 'dHex',
                  'NeuAc': 'NeuAc',
                  'NeuGc': 'NeuGc',
                  'Pen': 'Pentose',
                  'S': 'Sulphate',
                  'P': 'Phosphate',
                  'Kdn': 'Kdn',
                  'Kdo': 'Kdo',
                  'HexA': 'HexA',
                  'Methyl' : 'Methyl',
                  'Acetyl' : 'Acetyl',
                  'Other': 'Other'
              }
          },
        };
      }
      constructor() {
        super();
      }
      attached () {
          this.async(function(){this._setTogglesAndRSliders();},1);
      }
      _getLabel (monosaccharide) {
          return this.labels[monosaccharide];
      }
      _toggleGlycanFilter () {
          this._setTogglesAndRSliders();
          this.$.glycanFilterBox.toggle();
          if(this.$.foldIcon.hasAttribute('disabled')){
              this.$.expandIcon.setAttribute('disabled', 'true');
              this.$.foldIcon.removeAttribute('disabled');
          }else{
              this.$.foldIcon.setAttribute('disabled', 'true');
              this.$.expandIcon.removeAttribute('disabled');
          }
      }
      _setTogglesAndRSliders () {
          for (var idx in this.monosaccharides){
              var monosaccharide = this.monosaccharides[idx];
              Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeMin").value =   Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeCacheMin").value;
              Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeMax").value =   Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeCacheMax").value;
              this._createGlycanFilter('Min');
              this._createGlycanFilter('Max');
              // if (Polymer.dom(this.root).querySelector("#"+monosaccharide+"ToggleCache").value=='unchecked'){
              //       Polymer.dom(this.root).querySelector("#"+monosaccharide+"Toggle").removeAttribute('checked');
              //       Polymer.dom(this.root).querySelector("#"+monosaccharide+"Toggle").setAttribute('unchecked',true)
              //       Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeMin").setAttribute('disabled',true);
              // }else{
              //       Polymer.dom(this.root).querySelector("#"+monosaccharide+"Toggle").removeAttribute('unchecked');
              //       Polymer.dom(this.root).querySelector("#"+monosaccharide+"Toggle").setAttribute('checked',true);
              //       Polymer.dom(this.root).querySelector("#"+monosaccharide+"Label").innerHTML = "More or equal to "+   Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeMin").value;
              // }
          }
      }
      _getCompo () {
          var rangeBox = this.$.rangeBox;
          var paperInputs = Array.prototype.slice.call(rangeBox.getElementsByTagName('paper-slider'));
          var data = this;
          var compoString = '';
          paperInputs.forEach(function (item) {
              var monosaccharideId = item.id.replace("RangeMin","");
              var monoQuantity= data.shadowRoot.querySelector("#"+monosaccharideId+"RangeMin").value;
              compoString += monoQuantity;
          });
          console.log(compoString);
      }
      _reset () {
          var rangeBox = this.$.rangeBox;
          var paperInputs = Array.prototype.slice.call(rangeBox.getElementsByTagName('paper-slider'));
          var filterObject = {};
          var data = this;
          paperInputs.forEach(function (item) {
              var edge = item.getAttribute('edge');
              var rangeObject = {};
              var monosaccharideId = item.id.replace("Range"+edge,"");
              rangeObject["minRange"] = 0;
              rangeObject["presence"] = true;
              filterObject[monosaccharideId] = rangeObject;
              // data.shadowRoot.querySelector("#"+monosaccharideId+"Toggle").setAttribute('checked',true);
              // data.shadowRoot.querySelector("#"+monosaccharideId+"ToggleCache").value = true;
              data.shadowRoot.querySelector("#"+monosaccharideId+"Range"+edge).value = 0;
              data.shadowRoot.querySelector("#"+monosaccharideId+"RangeCache"+edge).value = 0;
              // var monosaccharidemin  = item.id.replace("RangeMin","");
              // data.shadowRoot.querySelector("#"+monosaccharide+"Label").textContent  = "More or equal to 0";
          });
          data.filter = filterObject;
      }
      // _changeOfSlider (event) {
      //     var monosaccharide  = event.target.id.replace("Toggle","");
      //     if(event.target.checked){
      //         Polymer.dom(this.root).querySelector("#"+monosaccharide+"ToggleCache").value = 'checked';
      //         Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeMin").disabled  = false;
      //         Polymer.dom(this.root).querySelector("#"+monosaccharide+"Label").textContent  =
      //             "More or equal to "+ Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeMin").value;
      //     } else{
      //         Polymer.dom(this.root).querySelector("#"+monosaccharide+"ToggleCache").value = 'unchecked';
      //         Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeMin").disabled  = true;
      //         Polymer.dom(this.root).querySelector("#"+monosaccharide+"Label").textContent  = "Not present";
      //     }
      //     this._createGlycanFilter();
      // }
      _changeOfRange (event) {
          var minOrMax = event.target.getAttribute("edge");

          var monosaccharide  = event.target.id.replace("Range"+minOrMax,"");
          var value = event.target.value;
          if (minOrMax == 'Min'){
            Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeMax").value  = +value;
            Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeCacheMax").value  = +value;
          };
          Polymer.dom(this.root).querySelector("#"+monosaccharide+"RangeCache"+minOrMax).value  = +value;
          // Polymer.dom(this.root).querySelector("#"+monosaccharide+"Label").textContent  = "More or equal to "+value;
          this._createGlycanFilter(minOrMax);
      }
      _createGlycanFilter (minOrMax) {
          var rangeBox = this.$.rangeBox;
          var paperInputs = Array.prototype.slice.call(rangeBox.getElementsByTagName('paper-slider'));
          var filterObject = {};
          paperInputs.forEach(function (item) {
              var rangeObject = {};
              var monosaccharideId = item.id.replace("Range"+minOrMax,"");
              rangeObject["minRange"] = item.value;
              // rangeObject["presence"] = Polymer.dom(rangeBox).querySelector("#"+monosaccharideId+"Toggle").checked;
              filterObject[monosaccharideId] = rangeObject;
          });
          this.filter = filterObject;
      }
      selectedPropN (){
        var selN =  Polymer.dom(this.$.selectedN).querySelectorAll("paper-button");
        var jsonParam = this.param(selN);
        jsonParam.glycanType = 'n-linked';
        this.filterOutput = jsonParam;
      }
      selectedPropO(){
        var selO = Polymer.dom(this.$.selectedO).querySelectorAll("paper-button");
        var jsonParam = this.param(selO);
        jsonParam.glycanType = 'o-linked';
        this.filterOutput = jsonParam;
      }
      selectedPropNP(){
        var selNP = Polymer.dom(this.$.selectedNP).querySelectorAll("paper-button");
        var jsonParam = this.param(selNP);
        jsonParam.glycanType = 'free';
        this.filterOutput = jsonParam;
      }
      param(propArray){
        var myJson = {};
        for (var i = 0; i < propArray.length; i++) {
          var x = propArray[i].getAttribute("data-id");
          var s = x.split("=");
          if (s[0] in myJson) {
            myJson[s[0]].push(s[1])
          } else {
            myJson[s[0]]=[s[1]];
          }
        }
        return myJson;
      }
      connectedCallback (){
        super.connectedCallback();
        this.$.ajaxDictionary.url = this.resolveUrl('dictionary/jsonGlobalProperties.json');
        this.$.ajaxDictionary.generateRequest();
        this.$.proteinDictionary.url = this.resolveUrl('http://mendel.isb-sib.ch:8083/api/proteins');
        this.$.proteinDictionary.generateRequest();
        // this.$.compoDictionary.url = this.resolveUrl('http://mendel.isb-sib.ch:8083/api/glycosylations?composition?');
        // this.$.compoDictionary.generateRequest();
      }
      handleResponse(data){
        var jsonGlobalProperties = data.detail.response;
        this.coreTypeO = jsonGlobalProperties['O-linked']['core'];
        this.coreTypeN = jsonGlobalProperties['N-linked']['core'];
        this.propO = jsonGlobalProperties['O-linked']['prop'];
        this.propN = jsonGlobalProperties['N-linked']['prop'];
        this.detO = jsonGlobalProperties['O-linked']['det'];
        this.detN = jsonGlobalProperties['N-linked']['det'];
        this.propNP = jsonGlobalProperties['Non attached to proteins']['prop'];
        this.detNP = jsonGlobalProperties['Non attached to proteins']['det'];
        this.coreTypeNP = jsonGlobalProperties['Non attached to proteins']['core'];
      }
      handleProtein(data){
        var jsonProtein = data.detail.response;
        var proteinList = [];
        var proteinIds = [];
        for (var f =0; f < jsonProtein.length; f ++){
          var protFeatures = jsonProtein[f];
          proteinList.push(protFeatures['name']);
          if (protFeatures['uniprots'] != undefined){
            var accs = protFeatures['uniprots'];
            var uniAcc;
            for ( uniAcc in accs){
              proteinIds.push(accs[uniAcc]['uniprot_acc']);
            };
          };
        };
        Array.prototype.push.apply(proteinList, proteinIds);
        // console.log(proteinList);
        var combobox = Polymer.dom(this.root).querySelector('#protDropDown');
        var elements = proteinList;//["Hydrogen", "Helium", "Silicon"];
        combobox.items = elements;
        Polymer.dom(this.root).querySelector('#sendDataProt').addEventListener('click', function() {
          console.log(combobox.value);
        });
      }
      // handleCompo(data){
      //   var jsonCompo = data.detail.response;
      //   var compoList = [];
      //   for (var c =0; c < jsonCompo.length; c ++){
      //     var compo = jsonCompo[c]['composition'];
      //     compoList.push(compo);
      //   };
      //   // console.log(compoList);
      //   var vaadincompo = Polymer.dom(this.root).querySelector('#compoDropDown');
      //   var elements = compoList;//["Hydrogen", "Helium", "Silicon"];
      //   vaadincompo.items = elements;
      //   Polymer.dom(this.root).querySelector('#sendDataComp').addEventListener('click', function() {
      //     console.log(vaadincompo.value);
      //   });
      // }

      _toggleProtein () {
        this.$.glycanFilterProt.toggle();
        this.expandFold()
      }
      // _toggleCompo () {
      //   this.$.glycanFilterCompo.toggle();
      //   this.expandFold()
      // }
      _toggleNGlycan () {
        this.$.glycanFilterN.toggle();
        this.expandFold()
      }
      _toggleOGlycan () {
        this.$.glycanFilterO.toggle();
        this.expandFold()
      }
      _toggleNOGlycan () {
        this.$.glycanFilterNO.toggle();
        this.expandFold()
      }
      expandFold (){
        if(this.$.foldIcon.hasAttribute('disabled')){
          this.$.expandIcon.setAttribute('disabled', 'true');
          this.$.foldIcon.removeAttribute('disabled');
        }else{
          this.$.foldIcon.setAttribute('disabled', 'true');
          this.$.expandIcon.removeAttribute('disabled');
        }
      }
      clearFilter(event) {
        var typeGlyco = event.target.getAttribute("typeLink");
        var vr = this.shadowRoot.querySelector("#selected"+typeGlyco);
        var toClear =  Polymer.dom(vr).querySelectorAll("paper-button");
        for (var i = 0; i < toClear.length; i++) {
          Polymer.dom(this.root).querySelector('paper-button[id='+toClear[i].id.replace("-clone",'')+']').hidden=false;
          toClear[i].remove();
        }
      }
      createTag(event) {
       var typeTag = event.target.getAttribute("typeLink");
       var list = Polymer.dom(this.root).querySelector("#selected"+typeTag);
       var sourceEl = event.target;
       var cloneEl = sourceEl.cloneNode(true);
       event.target.hidden=true;
       cloneEl.id=cloneEl.id+"-clone";
       list.insertBefore(cloneEl, null);
       cloneEl.addEventListener('tap', e => {this.destroyTag(e)});
     }
     destroyTag(pr) {
       Polymer.dom(this.root).querySelector('paper-button[id='+pr.target.id.replace("-clone",'')+']').hidden=false;
      pr.target.remove();
     }
     idCreator(id) {
       return "d_"+id.replace(/ /g,'').replace(/\(/g, '').replace(/\)/g, '').replace(/\,/g, "").replace("/","").replace(/\'/g,"");
     }
    }
    window.customElements.define(GlyconnectFilter.is, GlyconnectFilter);
    </script>
</dom-module>
