<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../paper-header-panel/paper-header-panel.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../app-layout/app-layout.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../sortable-list/sortable-list.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<!--
`glyconnect-filter`
This element provides filter box in glyconnect

@demo demo/index.html
-->

<dom-module id="glyconnect-filter">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment"></style>
    <style>
      :host {
        display: block;
      }
      iron-icon[disabled]{
        display: none;
      }
      paper-material {
          margin: 20px;
          background-color: #eee;
      }
      .enzymeList{
          padding: 5px;
          @apply(--layout-horizontal);
          @apply(--layout-wrap);
          min-width: 200px;
          min-height: 200px;
          align-content: center;
      }
      .enzymeSelected{
          padding: 5px;
          @apply(--layout-horizontal);
          @apply(--layout-wrap);
          min-height: 200px;
          width: 100%;
          align-items: right;
      }
      app-layout {
          background-color: #A4A4A4; /* changes the background to blue*/
          border-radius:5px;
          margin: 2px;
          height: 50px;
      }
      paper-button#filterToggleButton {
        width: 100%;
      }
      .paper-header {
        font-family: "Roboto";
        height: 45px;
        font-size: 20px;
        padding: 0 10px;
        /*color: red;*/
        transition: height 0.2s;
      }
      paper-button#updateButton {
        height: 50%;
        margin: 15px 30px;
      }
      #glycanFilterHeader {
        font-size: 16px;
        font-weight: 500;
        line-height: 25px;
      }
      .card {
        /*background-color: #cc3300;*/
        font-size: 16px;
        padding: 15px 15px 15px 15px;
        /*box-sizing: border-box;*/
        margin: 10px;
        flex: 0 0 auto;
        color: white;
      }
      .indigo {
          background-color: var(--paper-indigo-500);
          color: white;
          border-radius:5px;
          --paper-button-raised-keyboard-focus: {
              color: white !important;
          };
      }
      paper-tab:not(:last-child) {
          border-right: solid;
          border-color: #757575 ;
          border-width: 1px;
      }
      paper-tab.iron-selected {
          background-color: var(--paper-indigo-500);
          color: white;

      }
      paper-tabs{
        --paper-tabs-selection-bar-color: #eee;
        background-color: #eeeeee;
        color: black;
        font-size: 20px;
        font-weight: 600;
        border-radius: 5px;
        margin: 20px;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
      }
      .title {
        padding-top: 11px;
        color : white;
        font-size: 20px;
      }
      paper-icon-button.huge {
        width: 50px;
        height: 50px;
      }
    </style>
    <iron-ajax
            id="ajaxDictionary"
            handle-as="json"
            method="GET"
            last-response="{{jsonGlobalProperties}}"
            on-response="handleResponse"
    ></iron-ajax>
      <paper-header-panel id="glycanTypeFilter" class="blue" mode="seamed">
         <div id="glycanFilterHeader" class="paper-header">
             <paper-button id="filterToggleButton" class="indigo" on-click="_toggleNGlycan" toggles raised>
                 <iron-icon id="expandIconn" icon="icons:chevron-right" alt="unfold" ></iron-icon>
                 <iron-icon id="foldIconn" icon="icons:expand-more" alt="fold" disabled></iron-icon>
                 N-linked glycans
             </paper-button>
         </div>
      </paper-header-panel>
      <iron-collapse id="glycanFilterN" class="horizontal center-justified">
         <div class="layout horizontal flex" >
          <paper-material elevation="2" class="flex">
               <app-layout class="layout horizontal flex">
                   <paper-icon-button class="huge" disabled style="color: white" icon="icons:view-list"></paper-icon-button>
                   <span class="title">N-Glycan</span>
               </app-layout>
               <sortable-list id="selectedN" group="test"  animation="150" class="enzymeSelected"></sortable-list>
               <div class="horizontal end-justified layout">
                   <paper-button id="updateButton" class="indigo" on-tap="selectedPropN">Search</paper-button>
                   <paper-button id="updateButton" class="indigo" on-tap="clearFunction">Clear</paper-button>
                   <iron-ajax
                     id="requestStruct"
                     url="http://mendel.isb-sib.ch:8083/api/glycosylations?glycanType=n-linked"
                     params=''
                     handle-as="json"
                     last-response="{{octData}}"
                     ></iron-ajax>
               </div>
           </paper-material>
         </div>
         <div class="layout vertical flex">
             <paper-tabs selected="{{selected}}"  no-bar>
                 <paper-tab>Cores</paper-tab>
                 <paper-tab>Structural properties</paper-tab>
                 <paper-tab>Determinants</paper-tab>
             </paper-tabs>
             <iron-pages selected="{{selected}}">
                <paper-material elevation="2" class="flex" style="background: #eeeeee;">
                       <sortable-list id="list" group="test" animation="150" class="enzymeList" >
                           <template is="dom-repeat" items="{{coreTypeN}}">
                             <div data-id$="{{item.class}}={{item.name}}">
                               <!-- <!-Important: do not change data-id because it is used for generating the array in Sortable.toArray(). -->
                                <paper-card coreTypeN="{{item}}" class="card" style$="background-color:{{item.color}}">{{item.name}}</paper-card>
                             </div>
                           </template>
                       </sortable-list>
                 </paper-material>
                 <paper-material elevation="2" style="height: 100%" class="flex">
                     <sortable-list id="list" group="test" animation="150" class="enzymeList" >
                         <template is="dom-repeat" items="{{propN}}">
                           <div data-id$="{{item.class}}={{item.name}}">
                             <!-- Important: do not change data-id because it is used for generating the array in Sortable.toArray(). -->
                             <paper-card propN="{{item}}" class="card" style$="background-color:{{item.color}}">{{item.name}}</paper-card>
                           </div>
                         </template>
                     </sortable-list>
                 </paper-material>
                 <paper-material elevation="2" style="height: 100%" class="flex" >
                     <sortable-list id="list" group="test" animation="150" class="enzymeList" >
                         <template is="dom-repeat" items="{{detN}}">
                           <div data-id$="{{item.class}}={{item.name}}">
                             <!-- Important: do not change data-id because it is used for generating the array in Sortable.toArray(). -->
                             <paper-card detN="{{item}}" class="card" style$="background-color:{{item.color}}">{{item.name}}</paper-card>
                           </div>
                         </template>
                     </sortable-list>
                 </paper-material>
             </iron-pages>
         </div>
      </iron-collapse>
      <br><br>
      <paper-header-panel id="glycanTypeFilter" class="blue" mode="seamed">
          <div id="glycanFilterHeader" class="paper-header">
              <paper-button id="filterToggleButton" class="indigo" on-click="_toggleOGlycan" toggles raised>
                  <iron-icon id="expandIcono" icon="icons:chevron-right" alt="unfold" ></iron-icon>
                  <iron-icon id="foldIcono" icon="icons:expand-more" alt="fold" disabled></iron-icon>
                  O-linked glycans
              </paper-button>
          </div>
     </paper-header-panel>
      <iron-collapse id="glycanFilterO" class="horizontal center-justified">
        <div class="layout horizontal flex" >
         <paper-material elevation="2" class="flex">
           <app-layout class="layout horizontal flex">
               <paper-icon-button class="huge" disabled style="color: white" icon="icons:view-list"></paper-icon-button>
               <span class="title">O-Glycan</span>
           </app-layout>
              <sortable-list id="selectedO" group="test"  animation="150" class="enzymeSelected"></sortable-list>
              <div class="horizontal end-justified layout"><paper-button id="updateButton" class="indigo" on-tap="selectedPropO">Search</paper-button>
                <paper-button id="updateButton" class="indigo" on-tap="clearFunction">Clear</paper-button>
                <iron-ajax
                  id="requestStructO"
                  url="http://mendel.isb-sib.ch:8083/api/glycosylations?glycanType=o-linked"
                  params=''
                  handle-as="json"
                  last-response="{{octData}}"
                  ></iron-ajax>
              </div>
          </paper-material>
        </div>
        <div class="layout vertical flex">
            <paper-tabs selected="{{selected}}"  no-bar>
                <paper-tab>Cores</paper-tab>
                <paper-tab>Structural properties</paper-tab>
                <paper-tab>Determinants</paper-tab>
            </paper-tabs>
            <iron-pages selected="{{selected}}">
               <paper-material elevation="2" class="flex" style="background: #eeeeee;">
                      <sortable-list id="list" group="test" animation="150" class="enzymeList" >
                          <template is="dom-repeat" items="{{coreTypeO}}">
                            <div data-id$="{{item.class}}={{item.name}}">
                              <!-- <!-Important: do not change data-id because it is used for generating the array in Sortable.toArray(). -->
                               <paper-card coreTypeO="{{item}}" class="card" style$="background-color:{{item.color}}">{{item.name}}</paper-card>
                            </div>
                          </template>
                      </sortable-list>
                </paper-material>
                <paper-material elevation="2" style="height: 100%" class="flex">
                    <sortable-list id="list" group="test" animation="150" class="enzymeList" >
                        <template is="dom-repeat" items="{{propO}}">
                          <div data-id$="{{item.class}}={{item.name}}">
                            <!-- Important: do not change data-id because it is used for generating the array in Sortable.toArray(). -->
                            <paper-card propO="{{item}}" class="card" style$="background-color:{{item.color}}">{{item.name}}</paper-card>
                          </div>
                        </template>
                    </sortable-list>
                </paper-material>
                <paper-material elevation="2" style="height: 100%" class="flex" >
                    <sortable-list id="list" group="test" animation="150" class="enzymeList" >
                        <template is="dom-repeat" items="{{detO}}">
                          <div data-id$="{{item.class}}={{item.name}}">
                            <!-- Important: do not change data-id because it is used for generating the array in Sortable.toArray(). -->
                            <paper-card detO="{{item}}" class="card" style$="background-color:{{item.color}}">{{item.name}}</paper-card>
                          </div>
                        </template>
                    </sortable-list>
                </paper-material>
            </iron-pages>
        </div>
     </iron-collapse>
     <br><br>
     <paper-header-panel id="glycanTypeFilter" class="blue" mode="seamed">
         <div id="glycanFilterHeader" class="paper-header">
             <paper-button id="filterToggleButton" class="indigo" on-click="_toggleNOGlycan" toggles raised>
                 <iron-icon id="expandIconno" icon="icons:chevron-right" alt="unfold" ></iron-icon>
                 <iron-icon id="foldIconno" icon="icons:expand-more" alt="fold" disabled></iron-icon>
                 Non-attached to proteins
             </paper-button>
         </div>
     </paper-header-panel>
       <iron-collapse id="glycanFilterNO" class="horizontal center-justified">
        <div class="layout horizontal flex" >
          <paper-material elevation="2" class="flex">
            <app-layout class="layout horizontal flex">
                <paper-icon-button class="huge" disabled style="color: white" icon="icons:view-list"></paper-icon-button>
                <span class="title">Non-attached to proteins</span>
            </app-layout>
                   <sortable-list id="selectedNP" group="test"  animation="150" class="enzymeSelected"></sortable-list>
                  <div class="horizontal end-justified layout"><paper-button id="updateButton" class="indigo" on-tap="selectedPropNP">Search</paper-button>
                   <paper-button id="updateButton" class="indigo" on-tap="clearFunction">Clear</paper-button>
                    <iron-ajax
                      id="requestStructNP"
                      url="http://mendel.isb-sib.ch:8083/api/glycosylations?glycanType=free"
                      params=''
                      handle-as="json"
                      last-response="{{octData}}"
                      ></iron-ajax>
                  </div>
           </paper-material>
         </div>
         <div class="layout vertical flex">
             <paper-tabs selected="{{selected}}"  no-bar>
                 <paper-tab>Cores</paper-tab>
                 <paper-tab>Structural properties</paper-tab>
                 <paper-tab>Determinants</paper-tab>
             </paper-tabs>
             <iron-pages selected="{{selected}}">
                <paper-material elevation="2" class="flex" style="background: #eeeeee;">
                       <sortable-list id="list" group="test" animation="150" class="enzymeList" >
                           <template is="dom-repeat" items="{{coreTypeNP}}">
                             <div data-id$="{{item.class}}={{item.name}}">
                               <!-- <!-Important: do not change data-id because it is used for generating the array in Sortable.toArray(). -->
                                <paper-card coreTypeNP="{{item}}" class="card" style$="background-color:{{item.color}}">{{item.name}}</paper-card>
                             </div>
                           </template>
                       </sortable-list>
                 </paper-material>
                 <paper-material elevation="2" style="height: 100%" class="flex">
                     <sortable-list id="list" group="test" animation="150" class="enzymeList" >
                         <template is="dom-repeat" items="{{propNP}}">
                           <div data-id$="{{item.class}}={{item.name}}">
                             <!-- Important: do not change data-id because it is used for generating the array in Sortable.toArray(). -->
                             <paper-card propNP="{{item}}" class="card" style$="background-color:{{item.color}}">{{item.name}}</paper-card>
                           </div>
                         </template>
                     </sortable-list>
                 </paper-material>
                 <paper-material elevation="2" style="height: 100%" class="flex" >
                     <sortable-list id="list" group="test" animation="150" class="enzymeList" >
                         <template is="dom-repeat" items="{{detNP}}">
                           <div data-id$="{{item.class}}={{item.name}}">
                             <!-- Important: do not change data-id because it is used for generating the array in Sortable.toArray(). -->
                             <paper-card detNP="{{item}}" class="card" style$="background-color:{{item.color}}">{{item.name}}</paper-card>
                           </div>
                         </template>
                     </sortable-list>
                 </paper-material>
             </iron-pages>
         </div>
    </iron-collapse>
  </template>

  <script>
    Polymer({

      is: 'glyconnect-filter',
      properties: {
          repos: {
              type: Array
          },
          octData: {
            type: Object,
            notify: true,
            reflectToAttribute: true
          },
          selected: {
              type: String,
              value: 0
          },
          coreTypeNP: {
            type: Array,
            notify: true,
            reflectToAttribute: true,
          }
      },
      clearFunction: function() {
        Polymer.dom(this.root).querySelector('sortable-list[id="selectedNP"]').innerHTML="";
        Polymer.dom(this.root).querySelector('sortable-list[id="selectedN"]').innerHTML="";
        Polymer.dom(this.root).querySelector('sortable-list[id="selectedO"]').innerHTML="";
        this.$.ajaxDictionary.url = this.resolveUrl('dictionary/jsonGlobalProperties.json');
        this.$.ajaxDictionary.generateRequest();
      },
      selectedPropN: function(){
        var selN = this.$.selectedN._sortable.toArray();
        this.param(selN, this.$.requestStruct);
      },
      selectedPropO: function(){
        var selO = this.$.selectedO._sortable.toArray();
        this.param(selO, this.$.requestStructO);
      },
      selectedPropNP: function(){
        var selNP = this.$.selectedNP._sortable.toArray();
        this.param(selNP, this.$.requestStructNP);
      },
      param: function(propArray, requestType){
        var myJson = {};
        for (i = 0; i < propArray.length; i++) {
          var x = propArray[i];
          var s = x.split("=");
          if (s[0] in myJson) {
            myJson[s[0]].push(s[1])
          } else {
            myJson[s[0]]=[s[1]];
          };
        };
        requestType.set( 'params', myJson);
        requestType.generateRequest();
      },
      attached: function(){
        this.$.ajaxDictionary.url = this.resolveUrl('dictionary/jsonGlobalProperties.json');
        this.$.ajaxDictionary.generateRequest();
      },

      handleResponse: function(){
        this.coreTypeNP = undefined;
        this.coreTypeO = this.jsonGlobalProperties['O-linked']['core'];
        this.coreTypeN = this.jsonGlobalProperties['N-linked']['core'];
        this.propO = this.jsonGlobalProperties['O-linked']['prop'];
        this.propN = this.jsonGlobalProperties['N-linked']['prop'];
        this.detO = this.jsonGlobalProperties['O-linked']['det'];
        this.detN = this.jsonGlobalProperties['N-linked']['det'];
        this.propNP = this.jsonGlobalProperties['Non attached to proteins']['prop'];
        this.detNP = this.jsonGlobalProperties['Non attached to proteins']['det'];
        this.coreTypeNP = this.jsonGlobalProperties['Non attached to proteins']['core'];
        var repArray= Polymer.dom(this.root).querySelector('template[is="dom-repeat"]');
        for (var i =0; i<repArray.length; i++) {
          repArray[i].render();
        }
      },
      _toggleNGlycan: function () {
        togn=this.$.glycanFilterN;
        var type = "n";
        this.tog(togn, type)
      },
      _toggleOGlycan: function () {
        togo=this.$.glycanFilterO;
        var type = "o";
        this.tog(togo, type)
      },
      _toggleNOGlycan: function () {
        togno=this.$.glycanFilterNO;
        var type = "no";
        this.tog(togno, type)
      },
      tog: function (toggleType, linktype) {
        toggleType.toggle();
        var i = "foldIcon".concat(linktype);
        var y = "expandIcon".concat(linktype);
        var fold = Polymer.dom(this.root).querySelector('iron-icon[id="'+i+'"]');
        var unfold= Polymer.dom(this.root).querySelector('iron-icon[id="'+y+'"]');
        (y);
        if(fold.hasAttribute('disabled')){
            unfold.setAttribute('disabled', 'true');
            fold.removeAttribute('disabled');
        }else{
            fold.setAttribute('disabled', 'true');
            unfold.removeAttribute('disabled');
        }
      },
    });
  </script>
</dom-module>
