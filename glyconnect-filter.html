<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">

<!--
`glyconnect-filter`
This element provides filter box in glyconnect

@demo demo/index.html
-->

<dom-module id="glyconnect-filter">
  <template>
    <style is="custom-style" include="iron-flex"></style>
    <style>
      :host {
        display: block;
      }
    </style>
    <iron-ajax
            id="ajaxDictionary"
            handle-as="json"
            method="GET"
            last-response="{{globalDictionary}}"
            on-response="handleResponse"
    ></iron-ajax>
    <div class="horizontal layout">
    <paper-dropdown-menu label="Type" style="padding-right: 20px;">
      <paper-listbox class="dropdown-content" selected="{{typeSelected}}" attr-for-selected="glycantype">
        <template is="dom-repeat" items="{{glycanType}}">
          <paper-item glycantype="{{item}}">{{item}}</paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>

    <paper-dropdown-menu label="Core" style="padding-right: 20px;">
      <paper-listbox class="dropdown-content" selected="{{coreSelected}}" attr-for-selected="core">
        <template is="dom-repeat" items="{{coreType}}">
          <paper-item core="{{item}}">{{item}}</paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>

    <paper-dropdown-menu label="Properties" style="padding-right: 20px;">
      <paper-listbox class="dropdown-content" selected="{{propertySelected}}" attr-for-selected="property">
        <template is="dom-repeat" items="{{prop}}">
          <paper-item property="{{item}}">{{item}}</paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>

    <paper-dropdown-menu label="Determinants">
      <paper-listbox class="dropdown-content" selected="{{deterSelected}}" attr-for-selected="determinants">
        <template is="dom-repeat" items="{{deter}}">
          <paper-item determinants="{{item}}">{{item}}</paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>

    </div>
  </template>

  <script>
    Polymer({

      is: 'glyconnect-filter',

      properties: {
        typeSelected: {
          type: String,
          observer: "_typeChange"
        },
        coreSelected: {
          type: String,
          observer: "_coreSelectedChange"
        },
        propertySelected: {
          type: String,
          observer: "_propertySelectedChange"
        },
        deterSelected: {
          type: String,
          observer: "_propertySelectedChange"
        },
        prop: {
          type: String
        }
      },

      attached: function(){
        this.$.ajaxDictionary.url = this.resolveUrl('dictionary/globalDictionary.json');
        this.$.ajaxDictionary.generateRequest();
      },

      handleResponse: function(){
        this.glycanType = this.globalDictionary.type;
      },

      _typeChange: function(){
        this.coreType = this.globalDictionary[this.typeSelected];
      },

      _coreSelectedChange: function(){
        this.prop = this.globalDictionary[this.typeSelected+'_'+this.coreSelected];
      },
      _propertySelectedChange: function(){
        this.deter = this.globalDictionary[this.typeSelected+'_'+this.coreSelected+'_'+this.propertySelected];
        console.log(this.deter);
        console.log(this.coreSelected);
        console.log(this.typeSelected);
        console.log(this.propertySelected);
      },
      _filterCall: function(){
        //call server Julien
      }

      /* Possible Advanced Feature
          - server call for populate drop-down multi selections
       */

    });
  </script>
</dom-module>
